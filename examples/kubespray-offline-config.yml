# Kubespray 离线部署配置示例
# 将此配置添加到 inventory/mycluster/group_vars/all/offline.yml

# ============================================
# 离线模式配置
# ============================================

# 启用离线模式
download_localhost: false
download_run_once: true
download_keep_remote_cache: true

# ============================================
# 文件下载源配置
# ============================================

# 文件服务器地址 (替换为你的服务器 IP)
files_repo: "http://192.168.1.100:8080/k8s"

# 覆盖默认下载地址
dl_k8s_io_url: "{{ files_repo }}/dl.k8s.io"
github_url: "{{ files_repo }}/github.com"
storage_googleapis_url: "{{ files_repo }}/storage.googleapis.com"
get_helm_url: "{{ files_repo }}/get.helm.sh"

# ============================================
# 镜像仓库配置
# ============================================

# 镜像仓库地址
registry_host: "hub.kubespray.local:5000"

# 覆盖默认镜像仓库
kube_image_repo: "{{ registry_host }}/k8s/registry.k8s.io"
gcr_image_repo: "{{ registry_host }}/k8s"
docker_image_repo: "{{ registry_host }}/k8s/docker.io"
quay_image_repo: "{{ registry_host }}/k8s/quay.io"
github_image_repo: "{{ registry_host }}/k8s/ghcr.io"

# 具体镜像配置
etcd_image_repo: "{{ quay_image_repo }}/coreos/etcd"
calico_node_image_repo: "{{ quay_image_repo }}/calico/node"
calico_cni_image_repo: "{{ quay_image_repo }}/calico/cni"
calico_flexvol_image_repo: "{{ quay_image_repo }}/calico/pod2daemon-flexvol"
calico_policy_image_repo: "{{ quay_image_repo }}/calico/kube-controllers"
calico_typha_image_repo: "{{ quay_image_repo }}/calico/typha"
calico_apiserver_image_repo: "{{ quay_image_repo }}/calico/apiserver"

cilium_image_repo: "{{ quay_image_repo }}/cilium/cilium"
cilium_operator_image_repo: "{{ quay_image_repo }}/cilium/operator"

flannel_image_repo: "{{ docker_image_repo }}/flannel/flannel"
flannel_init_image_repo: "{{ docker_image_repo }}/flannel/flannel-cni-plugin"

pod_infra_image_repo: "{{ kube_image_repo }}/pause"
coredns_image_repo: "{{ kube_image_repo }}/coredns/coredns"
nodelocaldns_image_repo: "{{ kube_image_repo }}/dns/k8s-dns-node-cache"

nginx_image_repo: "{{ docker_image_repo }}/library/nginx"
haproxy_image_repo: "{{ docker_image_repo }}/library/haproxy"

metrics_server_image_repo: "{{ kube_image_repo }}/metrics-server/metrics-server"

# ============================================
# 容器运行时配置
# ============================================

# 如果使用 containerd，配置镜像仓库
containerd_registries_mirrors:
  - prefix: docker.io
    mirrors:
      - host: "{{ registry_host }}"
        capabilities: ["pull", "resolve"]
        skip_verify: true
  - prefix: registry.k8s.io
    mirrors:
      - host: "{{ registry_host }}"
        capabilities: ["pull", "resolve"]
        skip_verify: true
  - prefix: quay.io
    mirrors:
      - host: "{{ registry_host }}"
        capabilities: ["pull", "resolve"]
        skip_verify: true
  - prefix: ghcr.io
    mirrors:
      - host: "{{ registry_host }}"
        capabilities: ["pull", "resolve"]
        skip_verify: true

# ============================================
# 其他配置
# ============================================

# 跳过镜像拉取验证（如果使用自签名证书）
download_validate_certs: false

# 设置下载超时
download_timeout: 600
